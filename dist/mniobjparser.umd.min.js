// Build date: 2017-1116T10:51:29

var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[f]=g.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var f=0;return $jscomp.iteratorPrototype(function(){return f<b.length?{done:!1,value:b[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var f=b[Symbol.iterator];return f?f.call(b):$jscomp.arrayIterator(b)};
$jscomp.polyfill=function(b,f,g,e){if(f){g=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in g||(g[d]={});g=g[d]}b=b[b.length-1];e=g[b];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:f})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function f(){this.batch_=null}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;f.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};f.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var g=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(a){g(a,0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var d=a[c];delete a[c];try{d()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};f.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(h){c.reject(h)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(h){d||(d=!0,a.call(c,h))}}var c=this,d=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{var c;a:switch(typeof a){case "object":c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(h){this.reject_(h);return}"function"==
typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,c=0;c<a.length;++c)a[c].call(),
a[c]=null;this.onSettledCallbacks_=null}};var d=new f;e.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};e.prototype.settleSameAsThenable_=function(a,c){var d=this.createResolveAndReject_();try{a.call(c,d.resolve,d.reject)}catch(m){d.reject(m)}};e.prototype.then=function(a,c){function d(a,c){return"function"==typeof a?function(c){try{b(a(c))}catch(n){l(n)}}:c}var b,l,f=new e(function(a,c){b=a;l=c});this.callWhenSettled_(d(a,b),
d(c,l));return f};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,c){function h(){switch(b.state_){case 1:a(b.result_);break;case 2:c(b.result_);break;default:throw Error("Unexpected state: "+b.state_);}}var b=this;null==this.onSettledCallbacks_?d.asyncExecute(h):this.onSettledCallbacks_.push(function(){d.asyncExecute(h)})};e.resolve=function(a){return a instanceof e?a:new e(function(c,d){c(a)})};e.reject=function(a){return new e(function(c,d){d(a)})};
e.race=function(a){return new e(function(c,d){for(var b=$jscomp.makeIterator(a),h=b.next();!h.done;h=b.next())e.resolve(h.value).callWhenSettled_(c,d)})};e.all=function(a){var c=$jscomp.makeIterator(a),d=c.next();return d.done?e.resolve([]):new e(function(a,b){function h(c){return function(d){f[c]=d;l--;0==l&&a(f)}}var f=[],l=0;do f.push(void 0),l++,e.resolve(d.value).callWhenSettled_(h(f.length-1),b),d=c.next();while(!d.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(e.$jscomp$new$AsyncExecutor=function(){return new f});
return e},"es6-impl","es3");
(function(b,f){"object"===typeof exports&&"undefined"!==typeof module?f(exports):"function"===typeof define&&define.amd?define(["exports"],f):f(b.mniobjparser={})})(this,function(b){(function(){function b(a){this.value=a}function d(a){function c(e,h){try{var f=a[e](h),l=f.value;l instanceof b?Promise.resolve(l.value).then(function(a){c("next",a)},function(a){c("throw",a)}):d(f.done?"return":"normal",f.value)}catch(n){d("throw",n)}}function d(a,d){switch(a){case "return":e.resolve({value:d,done:!0});
break;case "throw":e.reject(d);break;default:e.resolve({value:d,done:!1})}(e=e.next)?c(e.key,e.arg):f=null}var e,f;this._invoke=function(a,d){return new Promise(function(b,h){b={key:a,arg:d,resolve:b,reject:h,next:null};f?f=f.next=b:(e=f=b,c(a,d))})};"function"!==typeof a.return&&(this.return=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(d.prototype[Symbol.asyncIterator]=function(){return this});d.prototype.next=function(a){return this._invoke("next",a)};d.prototype.throw=function(a){return this._invoke("throw",
a)};d.prototype.return=function(a){return this._invoke("return",a)};return{wrap:function(a){return function(){return new d(a.apply(this,arguments))}},await:function(a){return new b(a)}}})();var f=function(){function b(d,a){for(var c=0;c<a.length;c++){var b=a[c];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(d,b.key,b)}}return function(d,a,c){a&&b(d.prototype,a);c&&b(d,c);return d}}(),g=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
this._shapeData=this._tempResult=this._stackIndex=this._stack=null}f(b,[{key:"copy",value:function(d){this._stack=d._stack;this._stackIndex=d._stackIndex;this._tempResult=d._tempResult;this._shapeData=d._shapeData}},{key:"parse",value:function(d){try{this._parseRawData(d),this._arrangeData()}catch(a){console.warn("MNI OBJ file is invalid."),console.warn(a)}}},{key:"_parseRawData",value:function(d){this._stack=d.trim().split(/\s+/).reverse();this._stackIndex=this._stack.length-1;this._tempResult={};
d=this._popStack();var a,c,b,e,f,g;this._tempResult.type="P"===d?"polygon":"L"===d?"line":d;if("polygon"===this._tempResult.type)this._parseSurfProp(),this._tempResult.numVertices=parseInt(this._popStack(),10),this._parseVertices(),this._parseNormals(),this._tempResult.nitems=parseInt(this._popStack(),10);else if("line"===this._tempResult.type)this._parseSurfProp(),this._tempResult.numVertices=parseInt(this._popStack(),10),this._parseVertices(),this._tempResult.nitems=parseInt(this._popStack(),10);
else{this._tempResult.error=!0;this._tempResult.errorMessage='Invalid MNI Object class: must be "polygon" or "line"';return}this._parseColors();this._parseEndIndices();this._parseIndices();if("polygon"!==this._tempResult.type&&"line"===this._tempResult.type){b=this._tempResult.indices;e=this._tempResult.endIndices;c=this._tempResult.nitems;for(var k=f=g=0;k<c;k++)a=0===k?0:e[k-1],d=e[k],f+=2*(d-a-1);f=new Uint32Array(f);for(k=0;k<c;k++){a=0===k?0:e[k-1];f[g++]=b[a];d=e[k];for(a+=1;a<d-1;a++)f[g++]=
b[a],f[g++]=b[a];f[g++]=b[d-1]}this._tempResult.indices=f}}},{key:"_arrangeData",value:function(){this._shapeData={type:this._tempResult.type,vertices:this._tempResult.vertices,normals:this._tempResult.normals,colors:this._tempResult.colors,surfaceProperties:this._tempResult.surfaceProperties,error:this._tempResult.error,errorMessage:this._tempResult.errorMessage};var d=[this._shapeData.vertices.buffer,this._shapeData.colors.buffer];this._shapeData.normals&&d.push(this._shapeData.normals.buffer);
this._shapeData.shapes=this._tempResult.indices;d.push(this._tempResult.indices.buffer);4===this._shapeData.colors.length&&this._unrollColors()}},{key:"_unrollColors",value:function(){var d,a,c,b,f=this._shapeData.vertices.length/3*4,e=new Uint8Array(f);d=this._shapeData.colors[0];a=this._shapeData.colors[1];c=this._shapeData.colors[2];b=this._shapeData.colors[3];for(var g=0;g<f;g+=4)e[g]=255*d,e[g+1]=255*a,e[g+2]=255*c,e[g+3]=255*b;this._shapeData.colors=e}},{key:"_parseSurfProp",value:function(){"polygon"===
this._tempResult.type?this._tempResult.surfaceProperties={ambient:parseFloat(this._popStack()),diffuse:parseFloat(this._popStack()),specularReflectance:parseFloat(this._popStack()),specularScattering:parseFloat(this._popStack()),transparency:parseFloat(this._popStack())}:"line"===this._tempResult.type&&(this._tempResult.surfaceProperties={width:this._popStack()})}},{key:"_parseVertices",value:function(){for(var d=3*this._tempResult.numVertices,a=new Float32Array(d),c=0;c<d;c++)a[c]=parseFloat(this._popStack());
this._tempResult.vertices=a}},{key:"_parseNormals",value:function(){for(var d=3*this._tempResult.numVertices,a=new Float32Array(d),c=0;c<d;c++)a[c]=parseFloat(this._popStack());this._tempResult.normals=a}},{key:"_parseColors",value:function(){var d=parseInt(this._popStack(),10),a,c;if(0===d){a=new Float32Array(4);for(var b=0;4>b;b++)a[b]=parseFloat(this._popStack())}else if(1===d)for(c=4*this._tempResult.num_polygons,a=new Float32Array(c),b=0;b<c;b++)a[b]=parseFloat(this._popStack());else if(2===
d)for(c=4*this._tempResult.numVertices,a=new Float32Array(c),b=0;b<c;b++)a[b]=parseFloat(this._popStack());else this._tempResult.error=!0,this._tempResult.errorMessage="Invalid color flag: "+d;this._tempResult.colorFlag=d;this._tempResult.colors=a}},{key:"_parseEndIndices",value:function(){for(var b=this._tempResult.nitems,a=new Uint32Array(b),c=0;c<b;c++)a[c]=parseInt(this._popStack(),10);this._tempResult.endIndices=a}},{key:"_parseIndices",value:function(){for(var b=this._stackIndex+1,a=new Uint32Array(b),
c=0;c<b;c++)a[c]=parseInt(this._popStack(),10);this._tempResult.indices=a}},{key:"_popStack",value:function(){return this._stack[this._stackIndex--]}},{key:"isValid",value:function(){return!this._shapeData.error}},{key:"getErrorMessage",value:function(){return this._shapeData.errorMessage}},{key:"getShapeData",value:function(){return this._shapeData}},{key:"getShapeRawIndices",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.shapes}},
{key:"getRawVertices",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.vertices}},{key:"getRawNormals",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.normals}},{key:"getRawColors",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.colors}},
{key:"getSurfaceProperties",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.surfaceProperties}},{key:"getType",value:function(){return this._shapeData.type}},{key:"isPolygon",value:function(){return"polygon"===this._shapeData.type}},{key:"isLine",value:function(){return"line"===this._shapeData.type}}]);return b}();b.MniObjParser=g;Object.defineProperty(b,"__esModule",{value:!0})});
